# ============================================================================
# Tesslate Studio - Production Environment Configuration
# ============================================================================
# This file contains all configuration for Tesslate Studio production deployment.
# ============================================================================

# Instructions:
# 1. Copy this file: cp .env.prod.example .env.prod
# 2. Update all REQUIRED fields marked below
# 3. Review OPTIONAL fields and configure as needed
# 4. Deploy with: docker compose -f docker-compose.prod.yml up -d
# 5. Never commit the .env.prod file to version control

# ----------------------------------------------------------------------------
# Required Configuration
# ----------------------------------------------------------------------------

# Backend Secret Key (REQUIRED - CHANGE IN PRODUCTION!)
# Generate with: openssl rand -base64 64
SECRET_KEY=your-secret-key-here-change-this-in-production

# ----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# ----------------------------------------------------------------------------

# PostgreSQL Database (used by orchestrator)
POSTGRES_DB=tesslate
POSTGRES_USER=tesslate_user
# Generate with: openssl rand -base64 32
POSTGRES_PASSWORD=your_postgres_password_here

# ----------------------------------------------------------------------------
# LiteLLM Configuration (REQUIRED for AI features)
# ----------------------------------------------------------------------------
# External LiteLLM service configuration
# Point to your LiteLLM proxy server

LITELLM_API_BASE=https://your-litellm-proxy.com/v1
LITELLM_MASTER_KEY=your_litellm_master_key_here

# LiteLLM User Configuration
# Models available to new users (comma-separated, no spaces)
# Example: gpt-4o-mini,gpt-4o,gpt-3.5-turbo,claude-3-opus,claude-3-sonnet
# These should match model names configured in your LiteLLM proxy
LITELLM_DEFAULT_MODELS=gpt-4o-mini,gpt-4o,gpt-3.5-turbo,claude-3-opus,claude-3-sonnet

# Team/access group for users in your LiteLLM setup
LITELLM_TEAM_ID=default

# Email domain for internal user emails (typically matches APP_DOMAIN)
LITELLM_EMAIL_DOMAIN=${APP_DOMAIN}

# Initial budget per user in USD
LITELLM_INITIAL_BUDGET=10.0

# ----------------------------------------------------------------------------
# Agent Resource Limits (optional - has defaults)
# ----------------------------------------------------------------------------
# These limits prevent runaway costs and infinite loops in AI agents
# Limits are enforced globally across all agent executions

# Maximum total cost across all agent runs (USD)
# Default: 20.0
# AGENT_MAX_COST=20.0

# Maximum total iterations across all agent runs
# Default: 100
# AGENT_MAX_ITERATIONS=100

# Maximum cost per individual agent run (USD)
# Default: 5.0
# AGENT_MAX_COST_PER_RUN=5.0

# ----------------------------------------------------------------------------
# Container Cleanup Configuration (optional - has defaults)
# ----------------------------------------------------------------------------
# Two-tier cleanup system for idle development containers
# Helps manage resources and prevent runaway costs

# How often to run the cleanup check (minutes)
# Default: 2
# CONTAINER_CLEANUP_INTERVAL_MINUTES=2

# Tier 1: Pause containers after being idle for X minutes
# Default: 15
# CONTAINER_CLEANUP_TIER1_IDLE_MINUTES=15

# Tier 2: Remove containers after being paused for X hours
# Default: 24
# CONTAINER_CLEANUP_TIER2_PAUSED_HOURS=24

# ----------------------------------------------------------------------------
# Domain and Port Configuration (REQUIRED)
# ----------------------------------------------------------------------------

# Your production domain (no protocol, just domain)
# Examples: studio.tesslate.com, studio-demo.tesslate.com, app.yourdomain.com
# This is used for:
#   - Main app routing
#   - OAuth redirect URLs
#   - Subdomain-based project preview environments (project-slug.{APP_DOMAIN})
#   - CORS wildcard pattern matching (*.{APP_DOMAIN})
APP_DOMAIN=studio-demo.tesslate.com

# Application Protocol (usually https for production)
APP_PROTOCOL=https

# Application Ports (standard ports for production)
APP_PORT=80
APP_SECURE_PORT=443
TRAEFIK_DASHBOARD_PORT=8080

# Base URL (complete URL with protocol and domain)
# This is automatically constructed from APP_PROTOCOL and APP_DOMAIN
# Or you can override it directly
# DEV_SERVER_BASE_URL=https://studio-demo.tesslate.com

# ----------------------------------------------------------------------------
# CORS and Security Configuration
# ----------------------------------------------------------------------------

# CORS Allowed Origins (comma-separated list)
# Automatically constructed from APP_PROTOCOL and APP_DOMAIN
# Or you can override it directly
# CORS_ORIGINS=https://studio-demo.tesslate.com

# Allowed Hosts (comma-separated list)
# List of hostnames allowed for Content Security Policy
# Automatically uses APP_DOMAIN if not set
# ALLOWED_HOSTS=studio-demo.tesslate.com

# ----------------------------------------------------------------------------
# Traefik Configuration
# ----------------------------------------------------------------------------

# Traefik Basic Auth for Dashboard (REQUIRED for production security)
# Generate with: htpasswd -nb admin your-password
# Default below is admin:admin - CHANGE THIS IN PRODUCTION!
TRAEFIK_BASIC_AUTH=admin:$$2y$$10$$EIHbchqg0sjZLr9iZINqA.6Za7wPjGAVdTER2ob5whDLtHkkZSGbC

# Traefik certificate resolver name
# Development: "letsencrypt" (HTTP challenge, single domain)
# Production: "cloudflare" (DNS challenge, supports wildcard certs for *.${APP_DOMAIN})
TRAEFIK_CERT_RESOLVER=cloudflare

# ----------------------------------------------------------------------------
# Cloudflare Configuration (REQUIRED for Let's Encrypt DNS challenge)
# ----------------------------------------------------------------------------
# Required when using TRAEFIK_CERT_RESOLVER=cloudflare
# Get from: https://dash.cloudflare.com/profile/api-tokens
# Required permissions: Zone:DNS:Edit for your domain
CF_DNS_API_TOKEN=your_cloudflare_dns_api_token_here

# ----------------------------------------------------------------------------
# Authentication & OAuth Configuration
# ----------------------------------------------------------------------------

# Google OAuth (for login) - OPTIONAL
# See docs/GOOGLE_OAUTH_SETUP.md for detailed setup instructions
# Create OAuth credentials at: https://console.cloud.google.com/apis/credentials
# Authorized redirect URIs in Google Cloud Console:
#   - https://yourdomain.com/api/auth/google/callback (for production)
# If not configured, Google login will be disabled (graceful degradation)
# GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
# GOOGLE_CLIENT_SECRET=your-google-client-secret
# GOOGLE_OAUTH_REDIRECT_URI=https://${APP_DOMAIN}/api/auth/google/callback

# GitHub OAuth (for login) - OPTIONAL
# Create OAuth App at: https://github.com/settings/applications/new
# Authorization callback URL:
#   - https://yourdomain.com/api/auth/github/callback (for production)
# If not configured, GitHub login will be disabled (graceful degradation)
# GITHUB_CLIENT_ID=your_github_client_id
# GITHUB_CLIENT_SECRET=your_github_client_secret
# GITHUB_OAUTH_REDIRECT_URI=https://${APP_DOMAIN}/api/auth/github/callback

# Vercel OAuth (for deployments) - OPTIONAL
# Create Integration at: https://vercel.com/account/integrations
# Redirect URI: https://yourdomain.com/api/deployment-oauth/vercel/callback
# If not configured, Vercel deployments will require manual API tokens
# VERCEL_CLIENT_ID=your_vercel_client_id
# VERCEL_CLIENT_SECRET=your_vercel_client_secret
# VERCEL_OAUTH_REDIRECT_URI=https://${APP_DOMAIN}/api/deployment-oauth/vercel/callback

# Netlify OAuth (for deployments) - OPTIONAL
# Create OAuth App at: https://app.netlify.com/user/applications
# Redirect URI: https://yourdomain.com/api/deployment-oauth/netlify/callback
# If not configured, Netlify deployments will require manual API tokens
# NETLIFY_CLIENT_ID=your_netlify_client_id
# NETLIFY_CLIENT_SECRET=your_netlify_client_secret
# NETLIFY_OAUTH_REDIRECT_URI=https://${APP_DOMAIN}/api/deployment-oauth/netlify/callback

# ----------------------------------------------------------------------------
# CSRF and Cookie Security
# ----------------------------------------------------------------------------

# CSRF Protection
# Separate secret key for CSRF tokens (optional - defaults to SECRET_KEY if not set)
# Generate a secure random string (32+ characters recommended)
# Generate with: openssl rand -base64 32
# CSRF_SECRET_KEY=your-csrf-secret-key-here

# CSRF token maximum age in seconds
# Default: 86400 (24 hours)
# CSRF_TOKEN_MAX_AGE=86400

# Cookie Security Settings
# IMPORTANT: Set COOKIE_SECURE=true in production (requires HTTPS)
# Options: true, false
COOKIE_SECURE=true

# Cookie SameSite policy for CSRF protection
# Options: lax, strict, none
# Recommended: lax for production
COOKIE_SAMESITE=lax

# Cookie domain for authentication cookies (IMPORTANT for subdomains)
# Production: Set to your root domain (e.g., ".tesslate.com") to work across all subdomains
# This allows cookies to work across main domain and project preview subdomains
# COOKIE_DOMAIN=.tesslate.com

# ----------------------------------------------------------------------------
# Deployment Configuration (Multi-Provider Deployments)
# ----------------------------------------------------------------------------

# Deployment Encryption Key (base64 encoded Fernet key)
# Used to securely encrypt deployment provider credentials (Cloudflare, Vercel, Netlify, etc.)
# IMPORTANT: Generate a unique key for production (different from SECRET_KEY)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# If not set, will be derived from SECRET_KEY (not recommended for production)
# DEPLOYMENT_ENCRYPTION_KEY=your_base64_fernet_key_here

# Deployment timeout in seconds (default: 600 = 10 minutes)
# Maximum time allowed for deployment operations
# DEPLOYMENT_TIMEOUT=600

# Default build output directory (default: dist)
# Can be overridden per framework (e.g., .next for Next.js, build for CRA)
# DEPLOYMENT_BUILD_DIR=dist

# Provider API Base URLs (optional - has defaults)
# Only override if you need to use different API endpoints
# CLOUDFLARE_API_BASE=https://api.cloudflare.com/client/v4
# VERCEL_API_BASE=https://api.vercel.com
# NETLIFY_API_BASE=https://api.netlify.com/api/v1

# ----------------------------------------------------------------------------
# Stripe Configuration (for payments and subscriptions)
# ----------------------------------------------------------------------------

# Stripe API Keys
# Production mode keys: sk_live_*, pk_live_*
# Test mode keys: sk_test_*, pk_test_*
# Get from: https://dashboard.stripe.com/apikeys
# STRIPE_SECRET_KEY=sk_live_your_stripe_secret_key_here
# STRIPE_PUBLISHABLE_KEY=pk_live_your_stripe_publishable_key_here

# Stripe Webhook Secret
# Get from: https://dashboard.stripe.com/webhooks
# Create a webhook endpoint pointing to: https://yourdomain.com/api/webhooks/stripe
# STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here

# Stripe Connect (for creator payouts)
# Get from: https://dashboard.stripe.com/settings/applications
# STRIPE_CONNECT_CLIENT_ID=ca_your_connect_client_id_here

# ----------------------------------------------------------------------------
# Subscription Pricing Configuration
# ----------------------------------------------------------------------------

# Premium Subscription Price (in cents)
# Default: 500 = $5/month
PREMIUM_SUBSCRIPTION_PRICE=500

# Stripe Price ID for Premium Subscription
# Create in Stripe Dashboard: Products -> Create Product -> Recurring
# Must be a recurring price with monthly billing
# STRIPE_PREMIUM_PRICE_ID=price_your_premium_subscription_price_id

# Credit Packages (in cents)
# Users can purchase credits to use for AI usage
CREDIT_PACKAGE_SMALL=500     # $5
CREDIT_PACKAGE_MEDIUM=1500   # $15
CREDIT_PACKAGE_LARGE=2500    # $25

# Deploy Pricing (in cents)
# Price per additional deploy slot beyond tier limits
ADDITIONAL_DEPLOY_PRICE=1000  # $10

# ----------------------------------------------------------------------------
# Subscription Tier Limits
# ----------------------------------------------------------------------------

# Free Tier Limits
FREE_MAX_PROJECTS=1  # Maximum active projects

# Premium Tier Limits
PREMIUM_MAX_PROJECTS=5  # Maximum active projects

# ----------------------------------------------------------------------------
# Revenue Sharing Configuration
# ----------------------------------------------------------------------------

# Creator revenue share (decimal, 0.90 = 90%)
CREATOR_REVENUE_SHARE=0.90

# Platform revenue share (decimal, 0.10 = 10%)
PLATFORM_REVENUE_SHARE=0.10

# ----------------------------------------------------------------------------
# PostHog Analytics (OPTIONAL)
# ----------------------------------------------------------------------------
# VITE_PUBLIC_POSTHOG_KEY=your_posthog_key_here
# VITE_PUBLIC_POSTHOG_HOST=https://us.i.posthog.com

# ----------------------------------------------------------------------------
# Application Configuration
# ----------------------------------------------------------------------------

# Deployment Mode (should always be docker for docker-compose.prod.yml)
DEPLOYMENT_MODE=docker

# ----------------------------------------------------------------------------
# Kubernetes Multi-Container Architecture (for DEPLOYMENT_MODE=kubernetes)
# ----------------------------------------------------------------------------
# These settings are only used when deploying to Kubernetes cluster
# Not applicable for Docker Compose deployment

# Storage class for shared source code (must support ReadWriteMany for multi-container)
# Common options: nfs-client, efs-sc (AWS), azurefile (Azure), longhorn
# Optional - Default: nfs-client
# K8S_RWX_STORAGE_CLASS=nfs-client

# Ingress controller class name
# Common options: nginx, traefik, alb (AWS), gce (GCP)
# Optional - Default: nginx
# K8S_INGRESS_CLASS=nginx

# Enable namespace-per-project isolation (recommended for production)
# When true, each project gets its own namespace (proj-{uuid})
# When false, uses legacy shared namespace mode
# Optional - Default: true
# K8S_NAMESPACE_PER_PROJECT=true

# Enable NetworkPolicy creation for project isolation
# Requires CNI plugin with NetworkPolicy support (Calico, Cilium, Weave)
# Optional - Default: true
# K8S_ENABLE_NETWORK_POLICIES=true

# ----------------------------------------------------------------------------
# S3/Object Storage for Kubernetes Ephemeral Architecture (Hibernation)
# ----------------------------------------------------------------------------
# Enable S3-backed storage for Kubernetes mode (hibernation/hydration model)
# When true, project files are stored in S3 and loaded/saved on pod start/stop
# When false, uses persistent PVCs (default, recommended for multi-container)
# Optional - Default: false
# K8S_USE_S3_STORAGE=false

# S3-compatible storage settings (DigitalOcean Spaces, AWS S3, MinIO, etc.)
# Required if K8S_USE_S3_STORAGE=true
# S3_ACCESS_KEY_ID=your_s3_access_key_id
# S3_SECRET_ACCESS_KEY=your_s3_secret_access_key
# S3_ENDPOINT_URL=https://nyc3.digitaloceanspaces.com
# Optional - Default: tesslate-projects
# S3_BUCKET_NAME=tesslate-projects
# Optional - Default: us-east-1
# S3_REGION=us-east-1
# Optional - Default: projects
# S3_PROJECTS_PREFIX=projects

# Hibernation/Hydration settings (S3-backed storage mode)
# Optional - Default: 30
# K8S_HIBERNATION_IDLE_MINUTES=30
# Optional - Default: 300
# K8S_HYDRATION_TIMEOUT_SECONDS=300
# Optional - Default: 120
# K8S_DEHYDRATION_TIMEOUT_SECONDS=120

# Dynamic PVC settings (S3-backed storage mode)
# Optional - Default: do-block-storage
# K8S_PVC_STORAGE_CLASS=do-block-storage
# Optional - Default: 5Gi
# K8S_PVC_SIZE=5Gi
# Optional - Default: ReadWriteOnce
# K8S_PVC_ACCESS_MODE=ReadWriteOnce
